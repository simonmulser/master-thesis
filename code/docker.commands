docker build -t proxy .

docker network create --subnet=240.0.0.0/4 --driver bridge isolated_network

recommended starting order:
docker run --detach=true --net=isolated_network --ip=240.0.0.4 --name=bob1 node bitcoind -dnsseed=0 -listen -logips -onlynet=ipv4 -listenonion=0 -datadir=/data -regtest -logtimemicros -debug
docker run --detach=true --net=isolated_network --ip=240.0.0.5 --name=bob2 node bitcoind -dnsseed=0 -listen -logips -onlynet=ipv4 -listenonion=0 -datadir=/data -regtest -logtimemicros -debug
docker run --detach=true --net=isolated_network --ip=240.0.0.2 --name=alice node bitcoind -dnsseed=0 -listen -logips -onlynet=ipv4 -listenonion=0 -datadir=/data -regtest -logtimemicros -debug

docker run -v $PWD/selfish_proxy:/tmp_code --net=isolated_network --ip=240.0.0.10 --rm --name=proxy proxy python /tmp_code/main.py -v --ips-public 240.0.0.4 240.0.0.5
docker run -v $PWD/selfish_proxy:/tmp_code --net=isolated_network --ip=240.0.0.10 --rm --name=proxy proxy python /tmp_code/main.py -v
docker run --net=isolated_network --ip=240.0.0.10 --rm --name=proxy proxy --ips-public 240.0.0.4 240.0.0.5

docker exec bob1 /bin/sh -c 'bitcoin-cli -regtest -datadir=/data generate 1'
docker exec bob1 /bin/sh -c 'bitcoin-cli -regtest -datadir=/data sendtoaddress $(bitcoin-cli -regtest -datadir=/data getnewaddress) 10.0'
for run in {1..101}; do docker exec bob1 /bin/sh -c 'bitcoin-cli -regtest -datadir=/data generate 1'; done
